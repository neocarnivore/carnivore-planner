<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ã‚«ãƒ¼ãƒ‹ãƒœã‚¢ãƒ»ãƒ—ãƒ©ãƒ³ãƒŠãƒ¼</title>
<meta name="theme-color" content="#0b0b0f">
<link rel="manifest" href="manifest.webmanifest">
<link rel="apple-touch-icon" href="icon-192.png">
<style>
  :root{
    --bg:#0b0b0f;--card:#151821;--text:#e8eef6;--muted:#9fb0c3;--acc:#48d1b5;--red:#ff7575;--input:#0f1218;--border:#23304a
  }
  .light{
    --bg:#f6f8fb;--card:#ffffff;--text:#1a2732;--muted:#597086;--acc:#0aa37f;--red:#d13b3b;--input:#ffffff;--border:#dfe8f2
  }
  *{box-sizing:border-box;font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Hiragino Kaku Gothic ProN","Yu Gothic",sans-serif}
  body{margin:0;background:linear-gradient(180deg,var(--bg),#10131b00);color:var(--text)}
  header{display:flex;justify-content:space-between;align-items:center;gap:8px;padding:16px 14px 6px;font-weight:800;font-size:20px}
  .wrap{padding:10px;max-width:860px;margin:auto}
  .card{background:var(--card);border-radius:14px;padding:14px;margin:10px 0;box-shadow:0 8px 24px rgba(0,0,0,.18);border:1px solid var(--border)}
  label{display:block;font-size:13px;color:var(--muted);margin:8px 0 6px}
  input,select,button{width:100%;padding:12px 10px;border-radius:10px;border:1px solid var(--border);background:var(--input);color:var(--text)}
  button{cursor:pointer;background:var(--acc);border:none;color:#fff;font-weight:700}
  .row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  @media (min-width:760px){ .row-3{grid-template-columns:1fr 1fr 1fr} }
  .grid{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px}
  .kpi{background:var(--input);border:1px solid var(--border);border-radius:12px;padding:10px;text-align:center}
  .kpi b{display:block;font-size:18px;margin-top:2px}
  .big{font-size:22px;font-weight:800;color:var(--acc)}
  .small{font-size:12px;color:var(--muted)}
  .warn{color:var(--red);font-size:12px;margin-top:6px}
  details{user-select:none}
  a{color:#088a70}
  .top-buttons{display:flex;gap:10px}
</style>
</head>
<body>
<header>
  <div>ã‚«ãƒ¼ãƒ‹ãƒœã‚¢ãƒ»ãƒ—ãƒ©ãƒ³ãƒŠãƒ¼ï¼ˆCarnivore / Ketovore / TKDï¼‰</div>
  <div class="top-buttons">
    <button id="themeToggle" style="width:auto;padding:8px 12px;background:transparent;border:1px solid var(--border);color:var(--text)">ğŸŒ™/â˜€ï¸</button>
  </div>
</header>

<div class="wrap">
  <!-- å…¥åŠ› -->
  <div class="card">
    <div class="row">
      <div>
        <label>æ€§åˆ¥</label>
        <select id="sex"><option value="M">ç”·æ€§</option><option value="F">å¥³æ€§</option></select>
      </div>
      <div>
        <label>å¹´é½¢ï¼ˆæ­³ï¼‰</label>
        <input id="age" type="number" value="30" min="12" max="99">
      </div>
    </div>
    <div class="row">
      <div>
        <label>èº«é•·ï¼ˆcmï¼‰</label>
        <input id="height" type="number" value="170" min="120" max="220">
      </div>
      <div>
        <label>ä½“é‡ï¼ˆkgï¼‰</label>
        <input id="weight" type="number" value="65" min="30" max="250">
      </div>
    </div>
    <div class="row">
      <div>
        <label>æ´»å‹•ä¿‚æ•°</label>
        <select id="af">
          <option value="1.2">1.20ï¼ˆã»ã¼é‹å‹•ãªã—ï¼‰</option>
          <option value="1.375">1.375ï¼ˆè»½ã‚ï¼šé€±1â€“3ï¼‰</option>
          <option value="1.55" selected>1.55ï¼ˆä¸­ç¨‹åº¦ï¼šé€±3â€“5ï¼‰</option>
          <option value="1.725">1.725ï¼ˆé«˜ã„ï¼šé€±6â€“7ï¼‰</option>
          <option value="1.9">1.90ï¼ˆéå¸¸ã«é«˜ã„/è‚‰ä½“åŠ´åƒï¼‰</option>
        </select>
      </div>
      <div>
        <label>é£Ÿäº‹æ³•</label>
        <select id="diet">
          <option value="Carnivore">CARNIVORE</option>
          <option value="Ketovore">KETOVORE</option>
          <option value="TKD">è‚‰é£Ÿå¯„ã‚ŠTKD</option>
        </select>
      </div>
    </div>
    <div class="row">
      <div>
        <label>Ketovore ç³–è³ªä¸Šé™ï¼ˆg/æ—¥ï¼‰</label>
        <input id="ketoCap" type="number" value="30" min="5" max="100">
      </div>
      <div>
        <label>ãƒ•ã‚£ãƒƒãƒˆãƒã‚¹</label>
        <select id="fitness">
          <option value="none">è©²å½“ãªã—</option>
          <option value="rest">ä¼‘æ¯æ—¥</option>
          <option value="train">é‹å‹•æ—¥</option>
        </select>
      </div>
    </div>
    <div class="row">
      <div>
        <label>TKD ãƒ™ãƒ¼ã‚¹ç³–è³ªï¼ˆg/æ—¥ï¼‰</label>
        <input id="tkdBase" type="number" value="10" min="0" max="100">
      </div>
      <div>
        <label>TKD ç³–è³ªï¼ˆg/kgãƒ»é‹å‹•æ™‚åŠ ç®—ï¼‰</label>
        <input id="tkdPerKg" type="number" value="0.5" step="0.1" min="0" max="2">
      </div>
    </div>
    <div style="margin-top:10px">
      <button id="calcBtn">è¨ˆç®—</button>
    </div>
  </div>

  <!-- çµæœï¼šåŸºç¤ãƒ‡ãƒ¼ã‚¿ -->
  <div class="card result" id="resultBase" style="display:none">
    <h3>åŸºç¤ãƒ‡ãƒ¼ã‚¿</h3>
    <div class="grid">
      <div class="kpi"><span class="small">BMI</span><b id="bmi">â€“</b></div>
      <div class="kpi"><span class="small">BMRï¼ˆåŸºç¤ä»£è¬ kcalï¼‰</span><b id="bmr">â€“</b></div>
      <div class="kpi"><span class="small">TDEEï¼ˆç·æ¶ˆè²» kcalï¼‰</span><b id="tdee">â€“</b></div>
    </div>
    <div class="small" id="bmiClassTxt" style="margin-top:8px"></div>
  </div>

  <!-- çµæœï¼šãƒã‚¯ãƒ­ -->
  <div class="card result" id="resultMacro" style="display:none">
    <h3>ã‚ãªãŸã®ç›®å®‰ï¼ˆ<span id="dietLabel">â€”</span>ï¼‰</h3>
    <div class="grid">
      <div class="kpi"><span class="small">ã‚«ãƒ­ãƒªãƒ¼</span><b class="big" id="kcal">â€“</b><span class="small">kcal/æ—¥</span></div>
      <div class="kpi"><span class="small">ã‚¿ãƒ³ãƒ‘ã‚¯è³ª</span><b id="p">â€“</b><span class="small">g/æ—¥</span></div>
      <div class="kpi"><span class="small">è„‚è³ª</span><b id="f">â€“</b><span class="small">g/æ—¥</span></div>
    </div>
    <div class="grid" style="margin-top:10px">
      <div class="kpi"><span class="small">ç‚­æ°´åŒ–ç‰©</span><b id="c">â€“</b><span class="small">g/æ—¥</span></div>
      <div class="kpi"><span class="small">ã‚¿ãƒ³ãƒ‘ã‚¯è³ªã‹ã‚‰ã®kcal</span><b id="pkcal">â€“</b></div>
      <div class="kpi"><span class="small">è„‚è³ªã‹ã‚‰ã®kcal</span><b id="fkcal">â€“</b></div>
    </div>
    <div class="warn" id="fatWarn" style="display:none">â€»è„‚è³ªãŒè² ã«ãªã‚Šã¾ã—ãŸã€‚ã‚«ãƒ­ãƒªãƒ¼ç›®æ¨™ã‚’ä¸Šã’ã‚‹ã‹ç³–è³ª/ã‚¿ãƒ³ãƒ‘ã‚¯è³ªã‚’ä¸‹ã’ã¦ãã ã•ã„ã€‚</div>
  </div>

  <!-- ç°¡æ˜“ãƒŸã‚¯ãƒ­æ „é¤Šï¼ˆFoodDBï¼‹3è¡Œï¼‰ -->
  <div class="card result" id="resultMicro" style="display:none">
    <h3>ãƒ“ã‚¿ãƒŸãƒ³ãƒ»ãƒŸãƒãƒ©ãƒ«ï¼ˆã‚µãƒ³ãƒ—ãƒ«çŒ®ç«‹åˆè¨ˆï¼‰</h3>
    <div class="small" style="margin-bottom:8px">æ•°å€¤ã¯æ¦‚ç®—ï¼ˆ100gã‚ãŸã‚Šã®ä»£è¡¨å€¤ï¼‰ã§ã™ã€‚é£Ÿæã‚„éƒ¨ä½ã§å¤‰å‹•ã—ã¾ã™ã€‚</div>
    <div class="row-3 row">
      <div>
        <label>é£Ÿå“1</label>
        <select class="foodSel">
          <option value="ribeye">ç‰›ãƒªãƒ–ã‚¢ã‚¤</option>
          <option value="liver">ç‰›ãƒ¬ãƒãƒ¼</option>
          <option value="egg">åµ</option>
          <option value="salmon">ã‚µãƒ¼ãƒ¢ãƒ³</option>
          <option value="cheese">ãƒãƒ¼ã‚º</option>
        </select>
        <label>g</label>
        <input class="foodGram" type="number" value="200" min="0" step="10">
      </div>
      <div>
        <label>é£Ÿå“2</label>
        <select class="foodSel">
          <option value="ribeye">ç‰›ãƒªãƒ–ã‚¢ã‚¤</option>
          <option value="liver">ç‰›ãƒ¬ãƒãƒ¼</option>
          <option value="egg">åµ</option>
          <option value="salmon">ã‚µãƒ¼ãƒ¢ãƒ³</option>
          <option value="cheese">ãƒãƒ¼ã‚º</option>
        </select>
        <label>g</label>
        <input class="foodGram" type="number" value="50" min="0" step="10">
      </div>
      <div>
        <label>é£Ÿå“3</label>
        <select class="foodSel">
          <option value="ribeye">ç‰›ãƒªãƒ–ã‚¢ã‚¤</option>
          <option value="liver">ç‰›ãƒ¬ãƒãƒ¼</option>
          <option value="egg">åµ</option>
          <option value="salmon">ã‚µãƒ¼ãƒ¢ãƒ³</option>
          <option value="cheese">ãƒãƒ¼ã‚º</option>
        </select>
        <label>g</label>
        <input class="foodGram" type="number" value="100" min="0" step="10">
      </div>
    </div>
    <div class="grid" style="margin-top:10px">
      <div class="kpi"><span class="small">B12 (Âµg)</span><b id="b12">â€“</b></div>
      <div class="kpi"><span class="small">é‰„ (mg)</span><b id="iron">â€“</b></div>
      <div class="kpi"><span class="small">äºœé‰› (mg)</span><b id="zinc">â€“</b></div>
    </div>
    <div class="grid" style="margin-top:10px">
      <div class="kpi"><span class="small">ã‚»ãƒ¬ãƒ³ (Âµg)</span><b id="selen">â€“</b></div>
      <div class="kpi"><span class="small">ãƒ“ã‚¿ãƒŸãƒ³A RA (Âµg)</span><b id="vita">â€“</b></div>
      <div class="kpi"><span class="small">ã‚«ãƒªã‚¦ãƒ  (mg)</span><b id="k">â€“</b></div>
    </div>
    <div class="grid" style="margin-top:10px">
      <div class="kpi"><span class="small">ãƒã‚°ãƒã‚·ã‚¦ãƒ  (mg)</span><b id="mg">â€“</b></div>
      <div class="kpi"><span class="small">ãƒŠãƒˆãƒªã‚¦ãƒ  (mg)</span><b id="na">â€“</b></div>
      <div class="kpi"><span class="small">ã‚¿ãƒ³ãƒ‘ã‚¯è³ª (g)</span><b id="pMicro">â€“</b></div>
    </div>
    <div style="margin-top:10px">
      <button id="microBtn" style="background:transparent;border:1px solid var(--border);color:var(--text)">â†‘ é£Ÿå“ã®é‡ã‚’å¤‰ãˆãŸã‚‰æŠ¼ã™ï¼ˆå†è¨ˆç®—ï¼‰</button>
    </div>
  </div>

  <div class="wrap small" style="opacity:.85;padding-bottom:24px">
    â€»ãƒ—ãƒ©ãƒ³è¨­è¨ˆã¯ã‚«ãƒ¼ãƒ‹ãƒœã‚¢ãƒ»ã‚±ãƒˆã‚¸ã‚§ãƒ‹ãƒƒã‚¯ã‚’æ”¯æŒã™ã‚‹åŒ»å¸«ãƒ»åŒ»å­¦åšå£«ã‚‰ã®æ–‡çŒ®ãƒ»ç ”ç©¶ãƒ»è‘—æ›¸ã«åŸºã¥ãã¾ã™ã€‚<br>
    å‚è€ƒ: Virta Healthï¼ˆ<a href="https://www.youtube.com/@VirtaHealth" target="_blank">YouTube</a>ï¼‰/ The Noakes Foundationï¼ˆ<a href="https://www.youtube.com/@TheNoakesFoundation" target="_blank">YouTube</a>ï¼‰
  </div>
</div>

<script>
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => navigator.serviceWorker.register('./sw.js'));
}

// ãƒ†ãƒ¼ãƒåˆ‡æ›¿
const themeBtn = document.getElementById('themeToggle');
themeBtn.addEventListener('click', ()=>{
  document.body.classList.toggle('light');
  themeBtn.textContent = document.body.classList.contains('light') ? 'â˜€ï¸â†’ğŸŒ™' : 'ğŸŒ™â†’â˜€ï¸';
});

// å…¥åŠ›
const $ = id => document.getElementById(id);
const calcBtn = $("calcBtn");
const microBtn = $("microBtn");
const resultSections = [$("resultBase"), $("resultMacro"), $("resultMicro")];

// ç°¡æ˜“FoodDBï¼ˆ100gã‚ãŸã‚Šæ¦‚ç®—å€¤ï¼‰
const FOOD = {
  ribeye: {name:"ç‰›ãƒªãƒ–ã‚¢ã‚¤", P:20, B12:2.5, Fe:2.1, Zn:4.0, Se:28, VitA:20, K:330, Mg:22, Na:60},
  liver:  {name:"ç‰›ãƒ¬ãƒãƒ¼",   P:20, B12:70, Fe:6.2, Zn:4.0, Se:40, VitA:9000, K:350, Mg:18, Na:70},
  egg:    {name:"åµ",         P:13, B12:1.1, Fe:1.8, Zn:1.3, Se:30, VitA:160,  K:126, Mg:12, Na:124},
  salmon: {name:"ã‚µãƒ¼ãƒ¢ãƒ³",   P:21, B12:3.0, Fe:0.5, Zn:0.6, Se:36, VitA:50,   K:360, Mg:27, Na:59},
  cheese: {name:"ãƒãƒ¼ã‚º",     P:25, B12:1.5, Fe:0.7, Zn:3.0, Se:14, VitA:265,  K:98,  Mg:28, Na:620}
};

// BMIâ†’è¡¨ç¤ºãƒ†ã‚­ã‚¹ãƒˆ
function classText(bmi){
  if(bmi < 18.5) return "ä½ä½“é‡(<18.5)";
  if(bmi < 25)   return "æ™®é€š(18.5â€“24.9)";
  if(bmi < 30)   return "å‰è‚¥æº€(25â€“29.9)";
  if(bmi < 35)   return "è‚¥æº€I(30â€“34.9)";
  if(bmi < 40)   return "è‚¥æº€II(35â€“39.9)";
  return "è‚¥æº€III(â‰¥40)";
}

// è¨ˆç®—ï¼ˆãƒœã‚¿ãƒ³æŠ¼ä¸‹æ™‚ã®ã¿ï¼‰
calcBtn.addEventListener("click", calc);
function calc(){
  const sex = $("sex").value;
  const age = +$("age").value||0;
  const h   = +$("height").value||0;
  const w   = +$("weight").value||0;
  const af  = +$("af").value||1.2;
  const diet= $("diet").value;
  const ketoCap = +$("ketoCap").value||30;
  const fit = $("fitness").value;
  const tkdBase = +$("tkdBase").value||10;
  const tkdPerKg= +$("tkdPerKg").value||0.5;

  if(!h || !w || !age){ alert("å¹´é½¢ãƒ»èº«é•·ãƒ»ä½“é‡ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"); return; }

  const bmi = w / Math.pow(h/100,2);
  const bmr = (sex==="M") ? (10*w + 6.25*h - 5*age + 5) : (10*w + 6.25*h - 5*age - 161);
  const tdee = bmr * af;

  // ä¿‚æ•°ï¼šPã¯å›ºå®š2.2 g/kgï¼ˆè¦æœ›6ï¼‰ã€ã‚«ãƒ­ãƒªãƒ¼ã¯TDEEÃ—1.00ï¼ˆæ™®é€šä½“é‡æƒ³å®šï¼‰
  const protPerKg = 2.2;
  const calFac = 1.00;
  const prot_g = protPerKg * w;
  const calTarget = tdee * calFac;

  // Carb
  let carb_g = 5; // CARNIVORE ç—•è·¡åˆ†
  if(diet==="Ketovore") carb_g = ketoCap;
  if(diet==="TKD"){
    carb_g = tkdBase + (fit==="train" ? tkdPerKg * w : 0);
    if(fit==="none") carb_g = tkdBase; // è©²å½“ãªã—ã¯ãƒ™ãƒ¼ã‚¹ã®ã¿
    if(fit==="rest") carb_g = tkdBase; // ä¼‘æ¯æ—¥ã‚‚ãƒ™ãƒ¼ã‚¹ã®ã¿
  }

  let fat_g = (calTarget - 4*prot_g - 4*carb_g) / 9;
  const fatNeg = fat_g < 0;
  if(fatNeg) fat_g = 0;

  const kcal = 4*prot_g + 4*carb_g + 9*fat_g;

  // å‡ºåŠ›ï¼†è¡¨ç¤º
  $("bmi").textContent  = bmi.toFixed(2); // å°æ•°ç¬¬2ä½
  $("bmr").textContent  = Math.round(bmr).toLocaleString();
  $("tdee").textContent = Math.round(tdee).toLocaleString();
  $("bmiClassTxt").textContent = `BMIåŒºåˆ†ï¼š${classText(bmi)} ï½œ ã‚¿ãƒ³ãƒ‘ã‚¯è³ª ${protPerKg.toFixed(1)} g/kg ï½œ ã‚«ãƒ­ãƒªãƒ¼ä¿‚æ•° Ã—${calFac}`;

  $("dietLabel").textContent = (diet==="TKD" ? "è‚‰é£Ÿå¯„ã‚ŠTKD" : diet.toUpperCase());
  $("kcal").textContent = Math.round(kcal).toLocaleString();
  $("p").textContent    = Math.round(prot_g);
  $("f").textContent    = Math.round(fat_g);
  $("c").textContent    = Math.round(carb_g);
  $("pkcal").textContent= Math.round(prot_g*4);
  $("fkcal").textContent= Math.round(fat_g*9);
  $("fatWarn").style.display = fatNeg ? "block" : "none";

  // çµæœã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¡¨ç¤º
  resultSections.forEach(s => s.style.display = "block");

  // å¾®é‡æ „é¤Šç´ ã‚‚å†è¨ˆç®—
  calcMicro();
}

// å¾®é‡æ „é¤Šç´ ã®å†è¨ˆç®—
microBtn.addEventListener("click", calcMicro);
function calcMicro(){
  const sels = Array.from(document.querySelectorAll(".foodSel"));
  const grams= Array.from(document.querySelectorAll(".foodGram")).map(i=>+i.value||0);
  let sum = {P:0,B12:0,Fe:0,Zn:0,Se:0,VitA:0,K:0,Mg:0,Na:0};
  sels.forEach((sel,idx)=>{
    const it = FOOD[sel.value];
    const g = grams[idx];
    const factor = g/100;
    for(const k in sum){ sum[k] += (it[k]||0)*factor; }
  });
  $("b12").textContent = Math.round(sum.B12);
  $("iron").textContent= (Math.round(sum.Fe*10)/10).toFixed(1);
  $("zinc").textContent= (Math.round(sum.Zn*10)/10).toFixed(1);
  $("selen").textContent= Math.round(sum.Se);
  $("vita").textContent = Math.round(sum.VitA);
  $("k").textContent    = Math.round(sum.K);
  $("mg").textContent   = Math.round(sum.Mg);
  $("na").textContent   = Math.round(sum.Na);
  $("pMicro").textContent = Math.round(sum.P);
}
</script>
</body>
</html>
